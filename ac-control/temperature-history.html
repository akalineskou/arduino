<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="shortcut icon" href="https://cdn-icons-png.flaticon.com/512/3274/3274588.png"/>
<style>
    body {
        text-align: center;
        background-color: black;
        color: white;
    }

    a {
        text-decoration: none;
        color: lightskyblue;
    }

    a:hover {
        color: #ffffff;
    }

    a:active {
        color: #78adff;
    }
</style>
<head>
    <title>Temperature chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3"></script>
</head>
<body onload="init()">
<h2>Temperature history (<a href="/">Back</a>)</h2>

<canvas id="chart"></canvas>

<script>
    function init() {
        let chart = new Chart(document.getElementById('chart'), {
            type: "line",
            options: {
                responsive: true,
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                stacked: false,
                scales: {
                    x: {
                        type: "time",
                        distribution: "linear",
                    },
                    yTemperature: {
                        min: 10,
                        max: 30,
                        type: 'linear',
                        display: true,
                        position: 'left',
                    },
                    yTemperatureTargetStart: {
                        min: 10,
                        max: 30,
                        type: 'linear',
                        display: false,
                    },
                    yTemperatureTargetStop: {
                        min: 10,
                        max: 30,
                        type: 'linear',
                        display: false,
                    },
                    yHumidity: {
                        min: 50,
                        max: 70,
                        type: 'linear',
                        display: true,
                        position: 'right',

                        // grid line settings
                        grid: {
                            drawOnChartArea: false, // only want the grid lines for one axis to show up
                        },
                    },
                },
                plugins: {
                    legend: {
                        display: true,
                    },
                },
            },
            data: {
                labels: [],
                datasets: [
                    {
                        data: [],
                        label: "Temperature",
                        borderColor: "#3e95cd",
                        fill: false,
                        yAxisID: 'yTemperature',
                    },
                    {
                        data: [],
                        label: "Temperature target start",
                        borderColor: "red",
                        fill: false,
                        yAxisID: 'yTemperatureTargetStart',
                    },
                    {
                        data: [],
                        label: "Temperature target stop",
                        borderColor: "green",
                        fill: false,
                        yAxisID: 'yTemperatureTargetStop',
                    },
                    {
                        data: [],
                        label: "Humidity",
                        borderColor: "#bababa",
                        fill: false,
                        yAxisID: 'yHumidity',
                    },
                ],
            },
        });

        let json = [{
            "temperature": 18.600000,
            "temperatureTargetStart": 18.500000,
            "temperatureTargetStop": 20.000000,
            "humidity": 65.600000,
            "time": "2025-01-21 23:48:23"
        }, {
            "temperature": 18.600000,
            "temperatureTargetStart": 18.500000,
            "temperatureTargetStop": 20.000000,
            "humidity": 65.600000,
            "time": "2025-01-21 23:47:07"
        }, {
            "temperature": 18.600000,
            "temperatureTargetStart": 18.500000,
            "temperatureTargetStop": 20.000000,
            "humidity": 65.500000,
            "time": "2025-01-21 23:46:13"
        }, {
            "temperature": 18.600000,
            "temperatureTargetStart": 18.500000,
            "temperatureTargetStop": 20.000000,
            "humidity": 65.300000,
            "time": "2025-01-21 23:41:13"
        }, {
            "temperature": 18.600000,
            "temperatureTargetStart": 18.500000,
            "temperatureTargetStop": 20.000000,
            "humidity": 65.300000,
            "time": "2025-01-21 23:40:42"
        }, {
            "temperature": 18.600000,
            "temperatureTargetStart": 18.500000,
            "temperatureTargetStop": 20.000000,
            "humidity": 65.500000,
            "time": "2025-01-21 23:35:50"
        }];

        json.reverse();

        for (json of json) {
            chart.data.datasets[0].data.push({
                x: json.time,
                y: json.temperature,
            });
            chart.data.datasets[1].data.push({
                x: json.time,
                y: json.temperatureTargetStart,
            });
            chart.data.datasets[2].data.push({
                x: json.time,
                y: json.temperatureTargetStop,
            });
            chart.data.datasets[3].data.push({
                x: json.time,
                y: json.humidity,
            });
        }

        chart.update();
    }
</script>
</body>
</html>
